# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

æœ¬æ–‡æ¡£ä»‹ç» AI Customer Service Bot çš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‚

## ğŸ“Š æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®¢æˆ·ç«¯å±‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Web APP  â”‚  â”‚  Mobile  â”‚  â”‚  API    â”‚  â”‚ Third-party      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Nginx / åå‘ä»£ç†                          â”‚
â”‚              (SSL ç»ˆæ­¢ã€è´Ÿè½½å‡è¡¡ã€é™æ€æ–‡ä»¶æœåŠ¡)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FastAPI åº”ç”¨å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chat    â”‚  â”‚Knowledge â”‚  â”‚ History â”‚  â”‚   Health         â”‚ â”‚
â”‚  â”‚  API     â”‚  â”‚  API     â”‚  â”‚  API    â”‚  â”‚   Check          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              LangGraph å·¥ä½œæµå¼•æ“                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Intent  â”‚â†’â”‚ Retrievalâ”‚â†’â”‚  LLM    â”‚â†’â”‚ Response â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Router â”‚  â”‚  Engine â”‚  â”‚  Chain  â”‚â”‚  Builder â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Milvus         â”‚  â”‚   PostgreSQL     â”‚  â”‚   Redis          â”‚
â”‚   (å‘é‡æ•°æ®åº“)     â”‚  â”‚   (å…³ç³»æ•°æ®åº“)    â”‚  â”‚   (ç¼“å­˜)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¤–éƒ¨æœåŠ¡                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OpenAI  â”‚  â”‚  Claude  â”‚  â”‚  Gemini  â”‚  â”‚  Stormglass   â”‚ â”‚
â”‚  â”‚  GPT-4   â”‚  â”‚  Claude  â”‚  â”‚  Gemini  â”‚  â”‚  Weather API  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ æ ¸å¿ƒç»„ä»¶

### 1. FastAPI åº”ç”¨å±‚

| ç»„ä»¶ | èŒè´£ | æŠ€æœ¯ |
|------|------|------|
| Chat API | å¤„ç†å¯¹è¯è¯·æ±‚ï¼Œè¿”å›æ™ºèƒ½å›ç­” | FastAPI, Pydantic |
| Knowledge API | çŸ¥è¯†åº“æ–‡æ¡£ç®¡ç† | FastAPI, æ–‡ä»¶å¤„ç† |
| History API | å¯¹è¯å†å²ç®¡ç† | FastAPI, CRUD |
| Health API | å¥åº·æ£€æŸ¥ | FastAPI |

### 2. LangGraph å·¥ä½œæµå¼•æ“

```python
# å·¥ä½œæµèŠ‚ç‚¹å®šä¹‰
nodes = {
    "intent_router": "æ„å›¾è¯†åˆ«å’Œè·¯ç”±",
    "retrieval": "å‘é‡æ£€ç´¢",
    "llm_chain": "LLM å¯¹è¯é“¾",
    "response_builder": "å“åº”æ„å»º",
    "history_manager": "å†å²ç®¡ç†"
}

# å·¥ä½œæµè¾¹å®šä¹‰
edges = {
    "intent_router â†’ retrieval": "æ£€ç´¢æ„å›¾",
    "intent_router â†’ llm_chain": "ç›´æ¥å›ç­”",
    "retrieval â†’ llm_chain": "æ£€ç´¢ç»“æœ",
    "llm_chain â†’ response_builder": "LLM è¾“å‡º",
    "response_builder â†’ history_manager": "ä¿å­˜å†å²"
}
```

### 3. RAG æ£€ç´¢å¢å¼ºç³»ç»Ÿ

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query  â”‚  æŸ¥è¯¢å¤„ç†
â”‚ Transformâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vector â”‚  å‘é‡æ£€ç´¢ï¼ˆMilvusï¼‰
â”‚  Search â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Context â”‚  ä¸Šä¸‹æ–‡ç»„åˆ
â”‚ Combine â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM   â”‚  ç”Ÿæˆå›ç­”
â”‚  Prompt â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ•°æ®æµè®¾è®¡

### å¯¹è¯è¯·æ±‚æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant API as Chat API
    participant Graph as LangGraph
    participant RAG as RAG æœåŠ¡
    participant LLM as OpenAI
    participant DB as æ•°æ®åº“

    User->>API: POST /api/v1/chat
    API->>Graph: å¤„ç†å¯¹è¯è¯·æ±‚
    Graph->>RAG: æ£€ç´¢çŸ¥è¯†åº“
    RAG->>LLM: å¢å¼ºæç¤ºè¯
    LLM-->>RAG: ç”Ÿæˆå›ç­”
    RAG-->>Graph: è¿”å›ç»“æœ
    Graph->>DB: ä¿å­˜å¯¹è¯å†å²
    DB-->>API: ä¿å­˜æˆåŠŸ
    API-->>User: è¿”å›å“åº”
```

### çŸ¥è¯†åº“æ›´æ–°æµç¨‹

```mermaid
flowchart TD
    A[ä¸Šä¼ æ–‡æ¡£] --> B[æ–‡æ¡£è§£æ]
    B --> C[æ–‡æœ¬æå–]
    C --> D[åˆ†å—å¤„ç†]
    D --> E[å‘é‡åŒ–]
    E --> F[å­˜å…¥ Milvus]
    F --> G[æ›´æ–°ç´¢å¼•]
```

---

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨è®¾è®¡

### PostgreSQL è¡¨ç»“æ„

```sql
-- å¯¹è¯ä¼šè¯è¡¨
CREATE TABLE sessions (
    id VARCHAR(64) PRIMARY KEY,
    user_id VARCHAR(64),
    title VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- å¯¹è¯æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(64) REFERENCES sessions(id),
    role VARCHAR(20),  -- 'user' | 'assistant'
    content TEXT,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- çŸ¥è¯†åº“æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id VARCHAR(64) PRIMARY KEY,
    filename VARCHAR(255),
    category VARCHAR(64),
    status VARCHAR(20),  -- 'processing' | 'ready' | 'error'
    file_path VARCHAR(512),
    chunk_count INT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### Milvus Collection è®¾è®¡

```python
# çŸ¥è¯†åº“å‘é‡é›†åˆ
collection_schema = {
    "collection_name": "knowledge_base",
    "fields": [
        {"name": "id", "type": "Int64", "is_primary": True},
        {"name": "vector", "type": "FloatVector", "dim": 1536},
        {"name": "text", "type": "VARCHAR", "max_length": 4096},
        {"name": "document_id", "type": "VARCHAR", "max_length": 64},
        {"name": "metadata", "type": "JSON"}
    ],
    "index_params": [
        {"index_type": "HNSW", "metric_type": "COSINE"},
        {"index_type": "IVF_FLAT", "metric_type": "COSINE"}
    ]
}
```

---

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. è®¤è¯å’Œæˆæƒ

```python
# JWT Token éªŒè¯
async def verify_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload
    except JWTError:
        raise HTTPException(status_code=401)
```

### 2. API é€Ÿç‡é™åˆ¶

```python
from slowapi import Limiter

limiter = Limiter(key_func=get_remote_address)

@app.post("/api/v1/chat")
@limiter.limit("100/minute")
async def chat(request: Request):
    # ...
```

### 3. æ•°æ®åŠ å¯†

- **ä¼ è¾“å±‚**: HTTPS/TLS åŠ å¯†
- **å­˜å‚¨å±‚**: PostgreSQL TDEï¼ˆå¯é€‰ï¼‰
- **æ•æ„Ÿæ•°æ®**: ç¯å¢ƒå˜é‡åŠ å¯†å­˜å‚¨

---

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Nginx      â”‚
                    â”‚  Load Balancerâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App Pod 1  â”‚   â”‚  App Pod 2  â”‚   â”‚  App Pod 3  â”‚
â”‚  (FastAPI)   â”‚   â”‚  (FastAPI)  â”‚   â”‚  (FastAPI)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚   Redis      â”‚
                    â”‚   (Session)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‚ç›´æ‰©å±•å»ºè®®

| ç»„ä»¶ | æ‰©å±•ç­–ç•¥ |
|------|----------|
| FastAPI | å¢åŠ  worker è¿›ç¨‹æ•° |
| Milvus | å¢åŠ å†…å­˜ã€ä½¿ç”¨ GPU ç‰ˆæœ¬ |
| PostgreSQL | å¢åŠ è¿æ¥æ•°ã€ä¼˜åŒ–æŸ¥è¯¢ |
| Redis | é›†ç¾¤æ¨¡å¼ |

---

## ğŸš€ æ€§èƒ½æŒ‡æ ‡ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| API å“åº”æ—¶é—´ | < 500ms (P95) |
| å¹¶å‘è¿æ¥æ•° | 100+ |
| å‘é‡æ£€ç´¢ | < 100ms |
| å¯ç”¨æ€§ | 99.9% |
| æ¯æ—¥è°ƒç”¨é‡ | 10,000+ |

---

## ğŸ“ æ¶æ„æ¼”è¿›è·¯çº¿

```
v0.1.0 (å½“å‰)          v0.2.0              v1.0.0
   â”‚                     â”‚                  â”‚
   â–¼                     â–¼                  â–¼
å•å®ä¾‹éƒ¨ç½² â”€â”€â†’ è´Ÿè½½å‡è¡¡é›†ç¾¤ â”€â”€â†’ å¾®æœåŠ¡æ‹†åˆ†
   â”‚                     â”‚                  â”‚
   â–¼                     â–¼                  â–¼
å•ä¸€æ•°æ®åº“ â”€â”€â†’ ä¸»ä»å¤åˆ¶ â”€â”€â†’ åˆ†åº“åˆ†è¡¨
   â”‚                     â”‚                  â”‚
   â–¼                     â–¼                  â–¼
åŸºç¡€ RAG â”€â”€â†’ ä¼˜åŒ– RAG â”€â”€â†’ å¤šæ¨¡å‹æ··åˆ
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](../README.md)
- [API æ–‡æ¡£](API.md)
- [éƒ¨ç½²æŒ‡å—](DEPLOYMENT.md)
- [ä½¿ç”¨æŒ‡å—](USER_GUIDE.md)
